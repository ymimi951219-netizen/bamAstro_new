---
import type { RegionConfig } from '../../types/region';

interface Props {
  region: RegionConfig;
}

const { region } = Astro.props;

// 간소화된 네비게이션 구조
const mainNavItems = [
  { label: '홈', href: '/' },
  { label: '업종 가이드', href: '#', hasDropdown: 'venue' },
  { label: '유흥 가이드', href: '#', hasDropdown: 'guide' },
  { label: '지역별 가이드', href: '#', hasDropdown: 'area' },
  { label: '블로그', href: '/blog' },
  { label: '마케팅 문의', href: '/marketing' },
];
---

<header class="fixed top-4 md:top-6 left-1/2 -translate-x-1/2 w-[95%] max-w-5xl z-50 transition-all duration-300" id="main-header">
  <!-- Floating Island Container -->
  <div class="relative bg-slate-950/80 backdrop-blur-xl border border-white/10 rounded-full shadow-2xl px-4 md:px-6 h-14 md:h-16 flex items-center justify-between">
    
    <!-- Logo -->
    <a href="/" class="group flex items-center gap-2.5 shrink-0">
      <div class="relative w-8 h-8 rounded-full bg-gradient-to-br from-red-600 to-rose-600 flex items-center justify-center shadow-lg shadow-red-500/20 group-hover:scale-105 transition-transform">
           <img src="/logo.webp" alt={`${region.name} 로고`} class="w-5 h-5 object-contain" />
      </div>
      <div class="flex flex-col">
        <span class="text-sm md:text-base font-bold text-white tracking-tight leading-none">{region.name} 유흥</span>
      </div>
    </a>

      <!-- Desktop Navigation -->
      <nav class="hidden lg:flex items-center gap-1">
        {mainNavItems.map(item => (
          item.hasDropdown === 'venue' ? (
            <div class="relative group">
              <button class="flex items-center gap-1 px-4 py-2 text-sm font-medium text-slate-300 hover:text-white transition-all rounded-full hover:bg-white/5 group-hover:text-red-400">
                {item.label}
                <svg class="w-3 h-3 text-slate-500 group-hover:text-red-400 transition-transform group-hover:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              </button>

              <!-- Venue Dropdown Menu -->
              <div class="absolute top-full left-1/2 -translate-x-1/2 pt-4 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 ease-out translate-y-2 group-hover:translate-y-0">
                <div class="w-[280px] bg-slate-900/90 backdrop-blur-md border border-slate-700/50 rounded-2xl shadow-xl overflow-hidden p-2">
                  <div class="grid gap-1">
                    {region.venueTypes.slice(0, 8).map((type) => (
                      <a
                        href={`/${type.slug}`}
                        class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-slate-800 transition-colors group/item"
                      >
                         <div class="w-1.5 h-1.5 rounded-full bg-slate-600 group-hover/item:bg-red-500 transition-colors"></div>
                         <div class="text-sm font-medium text-slate-200 group-hover/item:text-white">{type.name}</div>
                      </a>
                    ))}
                     <a href={`/${region.id}-entertainment-hub`} class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-slate-800 transition-colors group/item border-t border-slate-800 mt-1 pt-3">
                         <span class="text-xs font-bold text-red-400">View All</span>
                         <span class="text-sm font-medium text-slate-300">전체 보기</span>
                      </a>
                  </div>
                </div>
              </div>
            </div>
          ) : item.hasDropdown === 'guide' ? (
            <div class="relative group">
              <button class="flex items-center gap-1 px-4 py-2 text-sm font-medium text-slate-300 hover:text-white transition-all rounded-full hover:bg-white/5">
                {item.label}
                <svg class="w-3 h-3 text-slate-500 group-hover:text-slate-300 transition-transform group-hover:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              </button>

              <!-- Guide Dropdown -->
               <div class="absolute top-full left-1/2 -translate-x-1/2 pt-4 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 ease-out translate-y-2 group-hover:translate-y-0">
                <div class="w-[200px] bg-slate-900/90 backdrop-blur-md border border-slate-700/50 rounded-2xl shadow-xl overflow-hidden p-2">
                    <a href={`/${region.id}-comparison-hub`} class="block px-3 py-2 rounded-xl hover:bg-slate-800 text-sm text-slate-300 hover:text-white transition-colors">업종 비교</a>
                    <a href={`/${region.id}-entertainment-price-guide`} class="block px-3 py-2 rounded-xl hover:bg-slate-800 text-sm text-slate-300 hover:text-white transition-colors">가격 총정리</a>
                    <a href={`/${region.id}-review-hub`} class="block px-3 py-2 rounded-xl hover:bg-slate-800 text-sm text-slate-300 hover:text-white transition-colors">후기 모음</a>
                    <a href="/guide" class="block px-3 py-2 rounded-xl hover:bg-slate-800 text-sm text-slate-300 hover:text-white transition-colors">초보 가이드</a>
                </div>
              </div>
            </div>
          ) : item.hasDropdown === 'area' ? (
             <div class="relative group">
              <button class="flex items-center gap-1 px-4 py-2 text-sm font-medium text-slate-300 hover:text-white transition-all rounded-full hover:bg-white/5">
                {item.label}
                <svg class="w-3 h-3 text-slate-500 group-hover:text-slate-300 transition-transform group-hover:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              </button>
               <div class="absolute top-full left-1/2 -translate-x-1/2 pt-4 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 ease-out translate-y-2 group-hover:translate-y-0">
                <div class="w-[180px] bg-slate-900/90 backdrop-blur-md border border-slate-700/50 rounded-2xl shadow-xl overflow-hidden p-2">
                     {region.stationDetails?.map(s => (
                        <a href={`/station/${s.slug}`} class="block px-3 py-2 rounded-xl hover:bg-slate-800 text-sm text-slate-300 hover:text-white transition-colors">{s.name}</a>
                     ))}
                </div>
              </div>
            </div>
          ) : !item.hasDropdown && (
            <a href={item.href} class="px-4 py-2 text-sm font-medium text-slate-300 hover:text-white transition-all rounded-full hover:bg-white/5">
              {item.label}
            </a>
          )
        ))}
      </nav>

      <!-- CTA Button -->
      <div class="flex items-center gap-3 shrink-0">
        <a href={`tel:${region.phone}`} class="hidden sm:flex items-center gap-2 px-5 py-2 bg-white text-slate-900 hover:bg-red-50 text-sm font-bold rounded-full transition-all shadow-lg hover:shadow-xl hover:scale-105">
          <svg class="w-3.5 h-3.5" viewBox="0 0 20 20" fill="currentColor">
            <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z" />
          </svg>
          예약하기
        </a>

        <!-- Mobile Menu Button -->
        <button id="mobile-menu-btn" class="lg:hidden p-2 text-slate-300 hover:text-white transition-colors" aria-label="메뉴">
          <svg id="menu-icon" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
          <svg id="close-icon" class="w-6 h-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
  </div>

  <!-- Mobile Menu (Full Screen Overlay) -->
  <div id="mobile-menu" class="hidden fixed inset-0 z-40 bg-slate-950/95 backdrop-blur-xl pt-24 px-6 overflow-y-auto transition-opacity duration-300 opacity-0">
     <div class="flex flex-col gap-6 animate-fade-in-up">
        {mainNavItems.map(item => (
            !item.hasDropdown ? (
                <a href={item.href} class="text-2xl font-bold text-white hover:text-red-400">{item.label}</a>
            ) : (
                <div class="space-y-3">
                    <div class="text-xs font-bold text-slate-500 uppercase tracking-widest">{item.label}</div>
                    <div class="grid grid-cols-2 gap-3">
                         {item.hasDropdown === 'venue' && region.venueTypes.slice(0,6).map(t => (
                             <a href={`/${t.slug}`} class="text-slate-300 hover:text-white p-2 bg-slate-900 rounded-lg text-sm">{t.name}</a>
                         ))}
                         {item.hasDropdown === 'guide' && (
                             <>
                                <a href={`/${region.id}-comparison-hub`} class="text-slate-300 hover:text-white p-2 bg-slate-900 rounded-lg text-sm">비교 가이드</a>
                                <a href={`/${region.id}-entertainment-price-guide`} class="text-slate-300 hover:text-white p-2 bg-slate-900 rounded-lg text-sm">가격 정보</a>
                             </>
                         )}
                         {item.hasDropdown === 'area' && region.stationDetails?.map(s => (
                              <a href={`/station/${s.slug}`} class="text-slate-300 hover:text-white p-2 bg-slate-900 rounded-lg text-sm">{s.name}</a>
                         ))}
                    </div>
                </div>
            )
        ))}
        
        <div class="mt-8 pt-6 border-t border-slate-800">
             <a href={`tel:${region.phone}`} class="flex items-center justify-center gap-2 w-full py-4 bg-gradient-to-r from-red-600 to-rose-600 hover:from-red-500 hover:to-rose-600 text-white font-bold rounded-xl transition-all shadow-lg active:scale-95">
                전화 예약하기
             </a>
        </div>
     </div>
  </div>
</header>

<script>
  const btn = document.getElementById('mobile-menu-btn');
  const menu = document.getElementById('mobile-menu');
  const menuIcon = document.getElementById('menu-icon');
  const closeIcon = document.getElementById('close-icon');

  btn?.addEventListener('click', () => {
    const isHidden = menu?.classList.contains('hidden');
    
    if (isHidden) {
        menu?.classList.remove('hidden');
        // Small delay to allow display:block to apply before opacity transition
        requestAnimationFrame(() => {
            menu?.classList.remove('opacity-0');
            menu?.classList.add('opacity-100');
        });
        document.body.style.overflow = 'hidden';
    } else {
        menu?.classList.remove('opacity-100');
        menu?.classList.add('opacity-0');
        setTimeout(() => {
            menu?.classList.add('hidden');
            document.body.style.overflow = '';
        }, 300);
    }

    menuIcon?.classList.toggle('hidden');
    closeIcon?.classList.toggle('hidden');
  });
</script>
